# API Security & Rate Limiting

**Protecting the front door.**

Public APIs are a target. Bots, scrapers, and malicious actors will try to overwhelm or exploit them. We implement defense-in-depth to protect DVMM.

---

## 1. Rate Limiting (Throttling)

We prevent any single user or IP from overwhelming the system.

*   **Token Bucket Algorithm:** Imagine a bucket that fills with 10 tokens per second. Every request costs 1 token. If the bucket is empty, the request is rejected.
*   **Granularity:**
    *   **Per User:** Authenticated users get a generous limit (e.g., 100 req/min).
    *   **Per IP:** Anonymous users (login page) get a strict limit (e.g., 10 req/min) to prevent brute-force attacks.
*   **Response:** `429 Too Many Requests`. Includes `Retry-After` header telling the client when to come back.

## 2. CSRF Protection (Cross-Site Request Forgery)

**The Attack:** A user is logged into DVMM. They visit `evil-site.com`. That site contains a hidden form that POSTs to `dvmm.com/api/delete-vm`. The browser sends the cookies automatically. The VM is deleted.

**The Defense:**
1.  **Safe Methods:** GET, HEAD, OPTIONS are safe.
2.  **Unsafe Methods:** POST, PUT, DELETE require a **CSRF Token**.
3.  **The Token:** A random string generated by the server and sent to the client in a header or cookie. `evil-site.com` cannot read this token (due to Same-Origin Policy), so it cannot construct a valid request.

## 3. Input Sanitization

**Never trust the client.**

*   **SQL Injection:** Prevented by using Parameterized Queries (jOOQ/R2DBC does this by default).
*   **XSS (Cross-Site Scripting):** React escapes all output by default. We also use a **Content Security Policy (CSP)** header to tell the browser: "Only execute scripts from *my* domain."
*   **Validation:** We use **Bean Validation** (`@Valid`, `@NotNull`, `@Size`) on all DTOs. Invalid requests are rejected with `400 Bad Request` before they reach business logic.

## 4. Security Headers

We configure Spring Security to send standard hardening headers:

*   `Strict-Transport-Security` (HSTS): Force HTTPS.
*   `X-Content-Type-Options: nosniff`: Prevent MIME-sniffing attacks.
*   `X-Frame-Options: DENY`: Prevent Clickjacking (running our app in an iframe).

## Summary

Security is not a feature; it is a baseline requirement. By layering these defenses, we ensure that DVMM is resilient against the most common web attacks.
